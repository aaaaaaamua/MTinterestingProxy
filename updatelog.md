好的，这是一份详细的代码更新日志总结，涵盖了我们这次“商业化特性”升级的所有关键点，你可以直接用于项目的 `CHANGELOG` 或发布说明。

---

# MTProxy 商业化授权功能更新日志 v0.1

### **1. 核心特性：MySQL 动态 Secret 管理**
*   **特性说明**：从静态配置升级为动态数据库驱动。Secret（密钥）列表不再依赖于程序启动时的硬编码或命令行参数，而是从 MySQL 数据库实时同步。
*   **技术实现**：
    *   引入后台同步线程，默认每 10 秒扫描数据库 `secrets` 表。
    *   支持 `is_active` 状态控制，可即时开启或禁用特定用户的访问权限。
    *   **高性能保障**：数据库数据被同步至内存高效结构中，握手阶段零数据库查询延迟。

### **2. 强力授权约束：一密钥一 IP 绑定 (Single-IP Binding)**
*   **特性说明**：为了防止密钥泄露或非法分发，实现了 Secret 与客户端 IP 的“一对一”锁定。
*   **详细机制**：
    *   **握手拦截**：客户端连接时，服务端会检查该 Secret 是否已被其他 IP 使用。如果是，则直接拒绝握手。
    *   **首次自动绑定**：当一个未绑定的有效 Secret 首次登录时，系统会自动记录并锁定当前客户端 IP。
    *   **动态解绑**：当某个 IP 下的所有连接全部断开时（连接引用计数归零），服务端会自动解除 IP 绑定，允许用户在更换网络环境后重新登录。

### **3. 灵活的部署配置**
*   **特性说明**：移除了硬编码的数据库信息，支持全量启动参数自定义。
*   **新增命令行参数**：
    *   `--db-host`：MySQL 服务器地址。
    *   `--db-port`：MySQL 监听端口。
    *   `--db-user`：数据库用户名。
    *   `--db-pwd`：数据库密码。
    *   `--db-name`：数据库名称。

### **4. 架构与稳定性优化**
*   **握手兼容性**：在 `Fake TLS` 和 `Random Header` (Obfuscation) 两种核心握手分支中均完美注入了 IP 绑定校验逻辑。
*   **Makefile 更新**：新增 `mysqlclient` 依赖库的自动化链接支持。
*   **底层追踪**：扩展了 `tcp_rpc_data` 结构体，增加 `secret_id` 追踪字段，实现了精准的连接回收与解绑计数。

### **5. 统计与监控增强**
*   **日志溯源**：在 `vkprintf` (级别 1) 中增加了详细的授权拦截日志，可记录 IP 冲突拒绝及自动解绑事件，方便商业审计。

---

### **快速启动示例：**
```bash
./mtproto-proxy [基础参数] \
  --db-host localhost \
  --db-port 7878 \
  --db-user root \
  --db-pwd YOUR_PASSWORD \
  --db-name YOUR_DB
```

---
这些更新使项目从一个简单的开源代理，进化为具备商业运营、精细化授权能力的专业服务端。希望能帮到你！